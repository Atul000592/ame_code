<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<title>AME DashBoard Controller</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<script src="js/local/resetChangeForget.js"></script>
	

	<script src="js/local/disable-back-button.js"></script>

	
</head>


<body>
<div th:replace="~{medical-sub-ordinate/master-doc::master-wrapper-doc}"></div>
	<div class="d-flex" id="wrapper">

		<!-- Sidebar -->
	<div th:replace="~{dealinghand/left-menu-dh::sidebar-wrapper-menu-dh}"></div>	<!-- /#sidebar-wrapper -->

		<!-- Page Content -->
		<div id="page-content-wrapper">

		<div th:replace="~{medical-sub-ordinate/nav-bar::sidebar-wrapper-menu-nav-ama}"></div>


			<div class="container mt-3">
		<div class="wisecountnactionbg">
		
		      <div th:replace="~{medical-sub-ordinate/inner-user-details::sidebar-wrapper-inner-user-details}"></div>


<div id="loading-overlay">
   <div class="spinner"></div>
  
  
</div>


				<form id="regForm"  class="proc-box p-3 text-start">
					
					<input type="hidden" th:value="${_csrf.token}" name="_csrf">
					<h6>Fill Hearing(Ear) data</h6>
					

					<hr>
					<div class="row">
						<div class="col-md-3 mb-2">
							<label>Normal in both ears</label>
						</div>
						<div class="col-md-3 mb-2">
							<select th:field="*{hearing.normal_in_both_ears}" class="form-control" id="normal_in_both_ears" >
								<option th:value="${hearing.normal_in_both_ears}"
									th:text="*{hearing.normal_in_both_ears}"></option>
								<option th:each="innerList : ${hearingDropDown.c1}" th:text="${innerList.value}"
									th:value="${innerList.value}">
								</option>
							</select>
							<span id="normalInBothEars_error" class="error"></span>
						</div>
						<div class="col-md-3 mb-2">
							<label>Auroscopy</label>
						</div>
						<div class="col-md-3 mb-2">
							<select th:field="*{hearing.auroscopy}" class="form-control" id="auroscopy" >
								<option th:value="${hearing.auroscopy}" th:text="*{hearing.auroscopy}"></option>
								<option th:each="innerList : ${hearingDropDown.c4}" th:text="${innerList.value}"
									th:value="${innerList.value}">
								</option>
							</select>
							<span id="auroscopy_error" class="error"></span>

						</div>
					</div>

					<div class="row">
						<div class="col-md-3 mb-2">
							<label>Moderate defect in one ear</label>
						</div>
						<div class="col-md-3 mb-2">
							<select th:field="*{hearing.moderate_defect_in_one_ear}" class="form-control" id="moderate_defect_in_one_ear" >
								<option th:value="${hearing.moderate_defect_in_one_ear}"
									th:text="*{hearing.moderate_defect_in_one_ear}"></option>
								<option th:each="innerList : ${hearingDropDown.c2}" th:text="${innerList.value}"
									th:value="${innerList.value}">
								</option>
							</select>
							<span id="moderateDefectInOneEar_error" class="error"></span>
						</div>
						<div class="col-md-3 mb-2">
							<label>Rennie's Test</label>
						</div>
						<div class="col-md-3 mb-2">
							<select th:field="*{hearing.rennie_test}" class="form-control"  id="rennie_test" >
								<option th:value="${hearing.rennie_test}" th:text="*{hearing.rennie_test}"></option>
								<option th:each="innerList : ${hearingDropDown.c5}" th:text="${innerList.value}"
									th:value="${innerList.value}">
								</option>
							</select>
							<span id="rennieTest_error" class="error"></span>
						</div>
					</div>


					<div class="row">
						<div class="col-md-3 mb-2">
							<label>Partial defect in both ear</label>
						</div>
						<div class="col-md-3 mb-2">
							<select th:field="*{hearing.partial_defect_in_both_ears}" class="form-control" id="partial_defect_in_both_ears" >
								<option th:value="${hearing.partial_defect_in_both_ears}"
									th:text="*{hearing.partial_defect_in_both_ears}"></option>
								<option th:each="innerList : ${hearingDropDown.c3}" th:text="${innerList.value}"
									th:value="${innerList.value}">
								</option>
							</select>
							<span id="partialDefectInBothEars_error" class="error"></span>

						</div>
						<div class="col-md-3 mb-2">
							<label>Weber's Test</label>
						</div>
						<div class="col-md-3 mb-2">
							<select th:field="*{hearing.weber_test}" class="form-control" id="weber_test" >
								<option th:value="${hearing.weber_test}" th:text="*{hearing.weber_test}"></option>
								<option th:each="innerList : ${hearingDropDown.c6}" th:text="${innerList.value}"
									th:value="${innerList.value}">
								</option>
							</select>
<span id="weberTest_error" class="error"></span>
						</div>
					</div>

					<div class="row">
						<div class="col-md-3 mb-2">
							<label>Any Other combinations</label>
						</div>
						<div class="col-md-3 mb-2">
							<input type="text" class="form-control" placeholder="" 
								th:field="*{hearing.any_other_combination}" id="any_other_combination">
								<span id="anyOtherCombination_error" class="error"></span>
						</div>

						<div class="col-md-3 mb-2">
							<label>Audiometry(if indicated)</label>
						</div>
						<div class="col-md-3 mb-2">
							<select th:field="*{hearing.audiometry}" class="form-control" id="audiometry" >
								<option th:value="${hearing.audiometry}" th:text="*{hearing.audiometry}"></option>
								<option th:each="innerList : ${hearingDropDown.c7}" th:text="${innerList.value}"
									th:value="${innerList.value}">
								</option>
							</select>
							<span id="audiometry_error" class="error"></span>
						</div>
					</div>
					<hr>
					
					


					<input type="hidden" name="forcepersonalId" th:value="${forcepersonalId}">
					<input type="hidden" name="ameId" th:value="${ameId}" id="ameId">
		
					<div class="button-div">
						<input type="button" class="btn btn-secondary button2" onclick="backToHome()"
							 value="Back">
						
						
						<input type="submit" class="btn btn-success button1 float-end"
							 value="Submit">
					
						
					</div>

				</form>
				<form th:action="@{/declaration-requests-completed-ma}" method="post" id="back-to-home">
					<input type="hidden" name="forcepersonalId" th:value="${forcepersonalId}">
					<input class="btn btn-secondary" type="hidden" name="ameId" th:value="${ameId}">

				</form>


			</div>

		

<div th:replace="~{medical-sub-ordinate/alert-modal::message-alert-modal}"></div>

</div>
	</div>
	<!-- /#page-content-wrapper -->

	</div>
	<!-- /#wrapper -->
	<script>
		function backToHome() {

			$("#back-to-home").submit();
		}
	</script>
	
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			setDefaultValues()
		
			
		});
		</script>



	

	<!-- Menu Toggle Script -->
	<script>
		$("#menu-toggle").click(function (e) {
			e.preventDefault();
			$("#wrapper").toggleClass("toggled");
		});
	</script>
	<script>
		function selectValue(prevValue) {

			if (prevValue == 'H-1' || prevValue == 'H-5') {
				$("#h_type").hide();
				$("#h_duration").hide();
			} else {
				$("#h_type").show();
				$("#h_duration").show();
				//$("#h_div").show();
			}
		}
	</script>




	<script>
		$('.sub-menu ul').hide();
		$('.sub-sub-menu ul').hide();
		$(".sub-menu a").click(function () {
			$(this).parent(".sub-menu").children("ul").slideToggle("100");
			$(this).find(".right").toggleClass("fa-caret-up fa-caret-down");
		});

		$(".sub-sub-menu a").click(function () {
			$(this).parent(".sub-sub-menu").children("ul").slideToggle("100");
			$(this).find(".right").toggleClass("fa-caret-up fa-caret-down");
		});
	</script>



	<!-- Signup Modal -->

		<div class="modal fade" id="signout-modal" data-bs-backdrop="static"
			data-bs-keyboard="false" tabindex="-1"
			aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Sign Out?</h5>

							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<!-- Modal body -->
						<div class="modal-body">
							<p class="text-center">Are you sure you want to Sign Out?</p>
							<form action="sign-out">
								<div class="row">
									<div class="col-md-6">
										<button type="submit" class="btn btn-primary">Sign
											Out</button>
									</div>
									<div class="col-md-6">
										<button type="button" class="btn btn-secondary"
											data-bs-dismiss="modal">Cancel</button>
									</div>

								</div>

							</form>

						</div>
					</div>
				</div>
			</div>
			</div>


	<script src="vendor/jquery-ui/jquery-ui.js"></script>
	<script>
		$(function () {
			$("#sortable-menu").sortable();
			$("#sortable-menu").disableSelection();

			$("#sortable-cards").sortable();
			$("#sortable-cards").disableSelection();
		});
	</script>


	<script>
		$(function () {
			$("#one-item-row").on("click", function () {
				$(".b-customize").addClass("col-lg-12", 300);
				$(".b-customize").removeClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-6", 300);

			});

			$("#two-item-row").on("click", function () {
				$(".b-customize").addClass("col-lg-6", 300);
				$(".b-customize").removeClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-12", 300);

			});

			$("#three-item-row").on("click", function () {
				$(".b-customize").addClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-6", 300);
				$(".b-customize").removeClass("col-lg-12", 300);

			});

		});
	</script>
	<script>
		var currentTab = 0; // Current tab is set to be the first tab (0)
		showTab(currentTab); // Display the current tab

		function showTab(n) {
			// This function will display the specified tab of the form...
			var x = document.getElementsByClassName("tab");
			x[n].style.display = "block";
			//... and fix the Previous/Next buttons:

			if (n == 0) {
				document.getElementById("prevBtn").style.display = "none";
			} else {
				document.getElementById("prevBtn").style.display = "inline";
			}
			if (n == (x.length - 1)) {
				document.getElementById("nextBtn").innerHTML = "Submit";
			} else {
				document.getElementById("nextBtn").innerHTML = "Next";
			}
			//... and run a function that will display the correct step indicator:
			fixStepIndicator(n);
			fixTabIndicator(n)
		}

		function nextPrev(n) {
			// This function will figure out which tab to display
			var x = document.getElementsByClassName("tab");
			// Exit the function if any field in the current tab is invalid:
			if (n == 1 && !validateForm()) return false;
			// Hide the current tab:
			x[currentTab].style.display = "none";
			// Increase or decrease the current tab by 1:
			currentTab = currentTab + n;
			// if you have reached the end of the form...
			if (currentTab >= x.length) {
				// ... the form gets submitted:
				document.getElementById("regForm").submit();
				return false;
			}
			// Otherwise, display the correct tab:
			showTab(currentTab);
		}

		function validateForm() {
			// This function deals with validation of the form fields
			var x, y, i, valid = true;
			x = document.getElementsByClassName("tab");
			y = x[currentTab].getElementsByTagName("input");
			// A loop that checks every input field in the current tab:
			for (i = 0; i < y.length; i++) {
				// If a field is empty...
				if (y[i].value == "") {
					// add an "invalid" class to the field:
					y[i].className += " invalid";
					// and set the current valid status to false
					valid = false;
				}
			}
			// If the valid status is true, mark the step as finished and valid:
			if (valid) {
				document.getElementsByClassName("step")[currentTab].className += " finish";
			}
			return valid; // return the valid status
		}

		function fixStepIndicator(n) {
			// This function removes the "active" class of all steps...
			var i, x = document.getElementsByClassName("step");
			for (i = 0; i < x.length; i++) {
				x[i].className = x[i].className.replace(" active", "");
			}
			//... and adds the "active" class on the current step:
			x[n].className += " active";
		}
		function fixTabIndicator(n) {
			// This function removes the "active" class of all steps...
			var i, x = document.getElementsByClassName("tabstatus");
			for (i = 0; i < x.length; i++) {
				x[i].className = x[i].className.replace(" active", "");
			}
			//... and adds the "active" class on the current step:
			x[n].className += " active";
		}
	</script>

	<script>
		function selectValue(e) {
			var i = e.value;
			if (i == 'H-1' || i == 'H-5') {
				$("#h_div").hide();
			} else {
				$("#h_div").show();
			}
		}



	</script>
	
<script>
$(document).ready(function() {
	$('#regForm').submit(function(event) {
		event.preventDefault();
		
		$('#loading-overlay').show();
		$('body').addClass('loading');
        
		var ameId = $("#ameId").val();
        var normal_in_both_ears=$("#normal_in_both_ears").val();
	    var auroscopy=$("#auroscopy").val();
	    var moderate_defect_in_one_ear=$("#moderate_defect_in_one_ear").val();
	    var rennie_test=$("#rennie_test").val();
	    var partial_defect_in_both_ears=$("#partial_defect_in_both_ears").val();
	    var weber_test=$("#weber_test").val();
	    var any_other_combination=$("#any_other_combination").val();
	    var audiometry=$("#audiometry").val();
	   
	    
		var data={
				ameId:ameId,
				normal_in_both_ears:normal_in_both_ears,
				auroscopy:auroscopy,
				moderate_defect_in_one_ear:moderate_defect_in_one_ear,
				rennie_test:rennie_test,
				partial_defect_in_both_ears:partial_defect_in_both_ears,
				weber_test:weber_test,
				any_other_combination:any_other_combination,
				audiometry:audiometry,
				
        }

		/* ===================header==================== */
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
		$('.error').text('');




		$.ajax({
			type: 'POST',
			url: 'validate-and-save-hearing-dealing-hand',
			data:JSON.stringify(data),
			contentType: 'application/json',
			beforeSend: function(xhr) {
				xhr.setRequestHeader(header, token);
			},
			success: function(response) {
				if (response.isValid) {
					
					 $('#alert-modal .modal-title').text('Success');
			            $('#alert-modal .modal-body h3').text(response.message);
			            
			            $('#alert-modal .modal-body i').removeClass('fas fa-exclamation-circle fa-lg animate__animated animate__shakeX')
			                                             .addClass('fas fa-check-circle faa-tada animated')
			                                             .removeAttr('style');
			            
			            $("#cross-close-button").attr('onclick', 'backToHome()');
			            $("#okay-close-button").attr('onclick', 'backToHome()');
			            $('#alert-modal').modal({
			                backdrop: 'static',
			                keyboard: false
			              });
						  	            $('#alert-modal').modal('show');
						  
					 }

				else {  
					
					$.each(response.errors, function(field, errorMessage) {
						 $('#' + field + '_error').text(errorMessage);
						 });
					}
				
},
complete: function() {
    $('#loading-overlay').hide();
    $('body').removeClass('loading');
},
			error: function(xhr, status, error) {

				if(xhr.responseText){

					$('#alert-modal .modal-title').text('ERROR');
		            $('#alert-modal .modal-body h3').text(xhr.responseText);
		            
		           $('#alert-modal .modal-body i')  .addClass('fas fa-exclamation-circle fa-lg animate__animated animate__shakeX')
	               .css('color', 'red');
		           $('#alert-modal').modal({
		                backdrop: 'static',
		                keyboard: false
		              });
		            $('#alert-modal').modal('show');
				}
					
					else{
						$('#alert-modal .modal-title').text('ERROR');
			            $('#alert-modal .modal-body h3').text('Server not responding please sign-in again');
			            
			            $('#alert-modal .modal-body i').addClass('fas fa-exclamation-circle fa-lg animate__animated animate__shakeX')
		                                               .css('color', 'red');
			            $('#alert-modal').modal({
			                backdrop: 'static',
			                keyboard: false
			              });
			            $('#alert-modal').modal('show');
						
					}}
		});
	});
});


//-------------Default values----------//
			function setDefaultValues() {
	
				    var normal_in_both_ears=$("#normal_in_both_ears").val();
				    var auroscopy=$("#auroscopy").val();
				    var moderate_defect_in_one_ear=$("#moderate_defect_in_one_ear").val();
				    var rennie_test=$("#rennie_test").val();
				    var partial_defect_in_both_ears=$("#partial_defect_in_both_ears").val();
				    var weber_test=$("#weber_test").val();
				    var any_other_combination=$("#any_other_combination").val();
				    var audiometry=$("#audiometry").val();
				   
				    if (! normal_in_both_ears) {
						$("#normal_in_both_ears").val('Yes');

					}
				    
				    if (! auroscopy) {
						$("#auroscopy").val('Not Done');

					}

				    if (! moderate_defect_in_one_ear) {
						$("#moderate_defect_in_one_ear").val('No');

					}

				    if (! rennie_test) {
						$("#rennie_test").val('AC>BC');

					}
				    
				    if (! partial_defect_in_both_ears) {
						$("#partial_defect_in_both_ears").val('No');

					}
				    
				    if (! weber_test) {
						$("#weber_test").val('CENTRALISED');

					}
				    
				    if (! audiometry) {
						$("#audiometry").val('Not Done');

					}

				    
				
				    
				  if (! any_other_combination) {
					$("#any_other_combination").val('NIL');

				     }
				  

				

			}


</script>	
	
	
	
	
</body>

</html>