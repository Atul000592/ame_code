<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<title>Change Password</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />


<link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css" />

<!-- Custom styles for this template -->
<link rel="stylesheet" href="css/base.css" />
<link rel="stylesheet" href="css/base-responsive.css" />
<link rel="stylesheet" href="css/animate.min.css" />
<link rel="stylesheet" href="css/slicknav.min.css" />
<link rel="stylesheet" href="css/font-awesome.min.css" />
<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet"
	type="text/css">


<!-- 	Bootstrap core JavaScript -->
	<script src="vendor/jquery/jquery.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="js/jquery.slicknav.min.js"></script>
	<script src="js/dashboard.js"></script>
	
	<script src="js/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
	<script src="js/ajax/libs/crypto-js/4.1.1/encryptMessage.js"></script>
	<script src="js/local/resetChangeForget.js"></script>
	





</head>

<body class="d-flex flex-column h-100 b-bg-image">



	<div class="top-head">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-6">
					<p>
						<img src="images/indian-flag.png" title="indian-flag"
							alt="indian flag" width="25" class="me-1"><span
							class="hindi-text"></span> | <span class="eng-text">Government
							of India</span>
					</p>
				</div>
				<div class="col-md-6"></div>


			</div>


		</div>

	</div>


	<header class="header">


		<div class="container-fluid">
			<div class="row d-flex">
				<div class="col-md-3">
				<div class="logo-wrap">
<img src="images/emblem-dark.png" class="emblem-logo" title="National Emblem of India"
				alt="emblem of india logo">
				
				
			<h4> Central Armed Police Forces</h4>
			<br>
			<p><span style="margin-right: 100px;">गृह मंत्रालय</span> <br> <span>Ministry of Home Affairs.</span></p>
</div>



				</div>

				<div class="col-md-6 text-center">
					<h2 class="web-logo">Annual Medical Examination</h2>

				</div>
				<div class="col-md-3">
					<img src="images/collage_CAPF.jpg" title="collage_CAPF"
						alt="collage_CAPFo" class="img-fluid logo-right">
				</div>

			</div>

		</div>


	</header>


	<!-- Begin page content -->
	<main class="flex-shrink-0">




		<div class="py-5">
			<div class="container">
				<div class="row justify-content-center">

					<div class="col-lg-4">

						<div class="login-wrap">

							<form th:action="save-reset-password-agian" method="post" id="resetform" >
							
								<h6 class="mb-3">Change Forget Password</h6>
								<hr>
								<span id="loginForcePersonalId_error" class="error"></span>
                                <div class="mb-3">
									<label for="old-password-label" class="form-label">Irla No</label> 
									<input type="text" class="form-control" 
									id="forceId" name="forceId" th:value="${token.forcePersonal.forceId}"
									 readonly> 
									

								</div>
								<div class="mb-3">
             <label for="old-password-label" class="form-label">New Password</label> 
             <input type="password" class="form-control" id="passwordId" aria-describedby="" placeholder="Enter your old password" name="password" maxlength="15" oninput="validatePassword()"> 
             <span id="old-password_error" class="error"></span>

								</div>
							<div class="mb-3">
									<label for="old-password-label" class="form-label">New Password</label> 
									<input type="password" class="form-control" id="passwordIdReType" aria-describedby="" placeholder="Enter your old password" name="reTypePassword" maxlength="15" oninput="validatePassword()"> 
									<span id="old-password_error" class="error"></span>

								</div>
	


								<div class="mb-3">
									<label for="confirm-password-label" class="form-label">OTP
										</label>
										<input type="text" class="form-control" name="otp" maxlength="6"> 
										<span id="confirm-password_error" class="error"></span>
								</div>
								  <div class="mb-3">
				            <label>Captcha</label>
				                  <input type="text" name="captcha" class="form-control">
				                <div id="captcha">
					                 <img id="captcha-img" th:src="@{captcha}" alt="Captcha Image">
					                   <a href="#" onclick="refreshCaptcha()">Refresh Captcha</a>
				                    </div>
				                      </div>
				<input type="hidden" name="id" th:value="${token.id}">
				
				

							
                              				<div class="mb-3">
				<span th:if="${error_message!=null}" th:text="${error_message}">
					
				</span>

				<ul id="validationHints">
					<li id="lengthHint" class="invalid">At least 8 characters</li>
					<li id="upperCaseHint" class="invalid">At least one uppercase letter</li>
					<li id="lowerCaseHint" class="invalid">At least one lowercase letter</li>
					<li id="numberHint" class="invalid">At least one number</li>
					<li id="specialCharHint" class="invalid">At least one special character</li>
					<li id="matchHint" class="invalid">Passwords must match</li>
				</ul>
			</div>
                          <div class="w-100 mt-3">

								<button type="button" class="btn btn-primary" onclick="resetPassword()">Submit</button>
									</div>
							</form>
							
							<input type="hidden" id="hexKey" th:value="${hexKeytoken}">
				<input type="hidden" id="ivHex" th:value="${ivHextoken}">	
						</div>


					</div>




				</div>
			</div>
		</div>

	</main>

	<!----------- Footer ------------>

	<footer class="mt-auto footer-bs">
		<div class="container">
			<div class="row justify-content-between">
				<div class="col-sm-12">
					<div class="footer-nav">
						<p>Quick Links �</p>

						<ul class="list">
							<li><a href="inner.html">Information Bulletin</a></li>
							<li><a href="contactus.html">Contact Us</a></li>
							<li><a href="inner.html">Result</a></li>
							<li data-toggle="modal" data-target="#feedback-modal"><a
								href="javascript:void(0)">Feedback</a></li>
							<li><a href="inner.html">Help Centre</a></li>
							<li><a href="javascript:void(0);">View Seat Matrix</a></li>
						</ul>
					</div>
				</div>

			</div>
		</div>


		<div class="footer-bootom">
			<div class="container-fluid">
				<div class="row">
					<div class="col-sm-2">

						<img src="images/digital-india.png" alt="digital india logo"
							width="80">
					</div>
					<div class="col-sm-8">
						<p>
							This site is designed and hosted by <a href="https://www.nic.in/"
								target="_blank" rel="noopener noreferrer">National Informatics Centre</a> | <a
								href="https://meity.gov.in/" target="_blank" rel="noopener noreferrer">Ministry of
								Electronics and IT</a> | <a href="https://www.india.gov.in/"
								target="_blank">Govt. of India.</a>
						</p>
					</div>
					<div class="col-sm-2 text-end">

						<img src="images/NIC.png" alt="NIC logo" width="80">
					</div>

				</div>
			</div>
		</div>
	</footer>




	<script>
						function signOut() {
							$("#sign-out-form").submit();
						}
					</script>

	<script>
						document.addEventListener("DOMContentLoaded",
								function() {
									selectedValue();
									//	selectedValueLeft();
									distantVision();
									nearVision()

								});
					</script>


	

	<!-- 	Menu Toggle Script -->
	<script>
						$("#menu-toggle").click(function(e) {
							e.preventDefault();
							$("#wrapper").toggleClass("toggled");
						});
					</script>

	

	<script>
		$(document).ready(
			function() {
				var prevValRight = document
				.getElementById('select-right').value;
				selectedValeRight(prevValRight);
				var prevValLeft = document.getElementById('select-left').value;
				selectedValeLeft(prevValLeft);
				$('#backtotop').click(function() {
					$("html, body").animate({
						scrollTop : 0
						}, 600);
						return false;
						});
						});
					</script>


	<script>
						$('.sub-menu ul').hide();
						$('.sub-sub-menu ul').hide();
						$(".sub-menu a").click(
								function() {
									$(this).parent(".sub-menu").children("ul")
											.slideToggle("100");
									$(this).find(".right").toggleClass(
											"fa-caret-up fa-caret-down");
								});

						$(".sub-sub-menu a").click(
								function() {
									$(this).parent(".sub-sub-menu").children(
											"ul").slideToggle("100");
									$(this).find(".right").toggleClass(
											"fa-caret-up fa-caret-down");
								});

function validatePassword() {
    const password = document.getElementById("passwordId").value;
    const confirmPassword = document.getElementById("passwordIdReType").value;
    
    // Criteria for password validation
    const minLength = 8;
    const hasUpperCase = /[A-Z]/.test(password);
    const hasLowerCase = /[a-z]/.test(password);
    const hasNumber = /[0-9]/.test(password);
    const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
    const passwordsMatch = password === confirmPassword;
    
    // Update the hints
    updateHint("lengthHint", password.length >= minLength);
    updateHint("upperCaseHint", hasUpperCase);
    updateHint("lowerCaseHint", hasLowerCase);
    updateHint("numberHint", hasNumber);
    updateHint("specialCharHint", hasSpecialChar);
    updateHint("matchHint", passwordsMatch);
}
function updateHint(hintId, isValid) {
    const hintElement = document.getElementById(hintId);
    if (isValid) {
        hintElement.classList.remove("invalid");
        hintElement.classList.add("valid");
    } else {
        hintElement.classList.remove("valid");
        hintElement.classList.add("invalid");
    }
}
function togglePasswordVisibility(passwordFieldId) {
    const passwordField = document.getElementById(passwordFieldId);
    if (passwordField.type === "password") {
        passwordField.type = "text";
    } else {
        passwordField.type = "password";
    }
}
</script>



	<!-- Signup Modal -->
	<div class="modal fade" id="signout-modal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header text-center d-block p-5 border-bottom-0">
					<h3 class="modal-title">Sign Out?</h3>
					<button type="button" class="close position-absolute"
						style="right: 15px; top: 8px;" data-dismiss="modal">&times;</button>
				</div>

				<!-- Modal body -->
				<div class="modal-body">
					<p class="text-center">Are you sure you want to Sign Out?</p>
					<div class="text-center py-4">
						<form action="sign-out">
							<button type="submit" class="btn btn-primary b-btn mx-3">Sign
								Out</button>
							<button class="btn btn-secondary mx-3" data-dismiss="modal">Cancel</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>



	<script src="vendor/jquery-ui/jquery-ui.js"></script>

	<style>
        .invalid { color: red; }
        .valid { color: green; }
    </style>
	<!-- =================================================Validation================================================================-->

	<script>
	$(document).ready(
		function() {
			$('#regForm')
			.submit(
				function(event) {
					event.preventDefault();
					$('#loading-overlay').show();
					$('body').addClass('loading');
					var loginForcePersonalId = $("#loginForcePersonalId").val();
					var oldPassword = $("#old-password").val();
					var newPassword = $("#new-password").val();
					var confirmPassword = $("#confirm-password").val();
                        var data = {
							loginForcePersonalId : loginForcePersonalId,
							oldPassword : oldPassword,
							newPassword : newPassword,
							confirmPassword : confirmPassword
							}
							/* ===================header==================== */
								var token = $("meta[name='_csrf']").attr("content");
							    var header = $("meta[name='_csrf_header']").attr("content");
									$('.error').text('');$.ajax({
										type : 'POST',
										url : 'validate-and-change-password',
										data : JSON.stringify(data),
										contentType : 'application/json',
										beforeSend : function(xhr) {
											xhr.setRequestHeader(header,token);
											},
											success : function(response) {
												if (response.isValid) {
													alert("Password Change Successfully, Please Login Again!")
													$('#sign-out-form').unbind('submit').submit();
																				}

															else {$.each(response.errors,
															function(field,errorMessage) 
															{$('#'+ field+ '_error').text(errorMessage);
															});
																				}

																			},
																			complete : function() {
																				$(
																						'#loading-overlay')
																						.hide();
																				$(
																						'body')
																						.removeClass(
																								'loading');
																			},
																			error : function(
																					xhr,
																					status,
																					error) {

																				alert("Please fill the form again somthing went WRONG!");
																				console
																						.error(error);
																			}
																		});
															});
										});
					</script>
</body>
</html>
 



</body>
</html>