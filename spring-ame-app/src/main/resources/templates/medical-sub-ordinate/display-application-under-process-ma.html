
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
<head>
<meta charset="ISO-8859-1">


<title>AME DashBoard Controller</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<div th:replace="~{medical-sub-ordinate/master-doc::master-wrapper-doc}"></div>
<script src="js/local/view-declaration-pdf/view-declaration-file.js"></script>

<!-- Include jQuery -->
<script src="ame-datatable-js/3.5.1/jquery.min.js"></script>

<!-- Include DataTables CSS -->
<link rel="stylesheet"
	href="ame-datatable-css/1.11.5/jquery.dataTables.min.css">

<!-- Include DataTables JavaScript -->
<script src="ame-datatable-js/1.11.5/jquery.dataTables.min.js"></script>

<script>
	$(document).ready(function() {
		$('#example').DataTable();
	});
	$(document).ready(function() {
		$('#example1').DataTable();
	});
</script>


</head>


<body>



	<div class="d-flex" id="wrapper">

		<!-- Sidebar -->
		<div
			th:replace="~{medical-sub-ordinate/left-menu-ama::sidebar-wrapper-menu-ama}"></div>
		<!-- /#sidebar-wrapper -->

		<!-- Page Content -->
		<div id="page-content-wrapper">

			<div
				th:replace="~{medical-sub-ordinate/nav-bar::sidebar-wrapper-menu-nav-ama}"></div>



			<div class="container-fluid mt-3">

				<!-- Content Row -->

				<div class="wisecountnactionbg">

					<div id="b-homedb">

						<span th:if="${message!=null}" th:text="${message}"></span>
						<div class="table-responsive ui-sortable-handle">
							<table class="table table-striped table-bordered table-hover"
								id="example">

								<thead class="table-light">
									<tr>
										<td colspan="9"><span
											style="font-size: 16px; font-weight: 600;">
												Declaration Received and Under Process </span></td>
									</tr>
									<tr>
										<th>Serial No</th>
										<th>IRLA No</th>
										<th>Name</th>

										<th>Rank/Designation</th>
										<th>Date Of Declaration</th>
										<th>Action</th>
										<!--<th>Physical Sign</th>-->
										<th>E-Sign</th>
										<th>Status Remark</th>

									</tr>
								</thead>
								<tr
									th:each="declarationDetails1,statcount :${declarationDetails}">
									<td th:text="${statcount.count}"></td>
									<td th:text="${declarationDetails1.forceId}"></td>

									<td th:text="${declarationDetails1.name}"></td>

									<td th:text="${declarationDetails1.rank}"></td>
									<td
										th:text="${#dates.format(declarationDetails1.declarationDate, 'dd/MM/yyyy')}"></td>

									<td th:if="${declarationDetails1.ameFinalStatus==0}">
										<form action="declaration-requests-completed-ma" method="post">
											<input type="hidden"
												th:value="${declarationDetails1.forcePersonalId}"
												name="forcepersonalId"> <input type="hidden"
												th:value="${declarationDetails1.ameId}" name="ameId">
											<input type="hidden" th:value="${_csrf.token}" name="_csrf">
											<input type="submit" value="Fill AME"
												class="btn btn-info btn-sm">
										</form>
									</td>
									<td th:unless="${declarationDetails1.ameFinalStatus==0}">
										<span>Completed </span>
									</td>
									<td
										th:if="${declarationDetails1.finalUploadFlag==0 && declarationDetails1.ameFinalStatus==1}">
										<form
											action="declaration-requests-completed-ma-upload-final-report"
											method="post">
											<input type="hidden"
												th:value="${declarationDetails1.forcePersonalId}"
												name="forcepersonalId"> <input type="hidden"
												th:value="${declarationDetails1.ameId}" name="ameId">
											<input type="hidden" th:value="${_csrf.token}" name="_csrf">
											<input type="submit" value="Signature"
												class="btn btn-info btn-sm">
										</form>
									</td>
									<td
										th:if="${declarationDetails1.finalUploadFlag==0 && declarationDetails1.ameFinalStatus==1}">
										<form action="generate-pdf" method="get" class="m-0"
											target="_blank" rel="noopener noreferrer">
											<input type="hidden"
												th:value="${declarationDetails1.forcePersonalId}"
												name="forcepersonalId"> <input type="hidden"
												th:value="${declarationDetails1.ameId}" name="ameId">
											<input type="hidden" th:value="${_csrf.token}" name="_csrf">
											<input type="submit" value="View Pdf" class="btn btn-info btn-sm">
										</form>
										
										<form id="pdfForm" th:action="@{generateamefinalPdf}"
																				method="get">
																				<input type="hidden"
																					th:value="${declarationDetails1.forcePersonalId}"
																					name="forcepersonalId"> <input type="hidden"
																					th:value="${declarationDetails1.ameId}" name="ameId">
																				<input type="submit" value="E-Sign"
																					class="btn btn-info btn-sm">
																			</form>
									</td>
									
									<td
										th:unless="${declarationDetails1.finalUploadFlag==0 && declarationDetails1.ameFinalStatus==1}">
										<span>Pending</span>
									</td>

									<td>
									<form id="${statcount.count}" th:action="@{modal-pending-status-remark-ama}" method="Post" th:object="${medicalRequestDto}">
																				
											<input type="hidden" id="${statcount.count}"  th:value="${declarationDetails1.ameId}"  name="ameId">
											<input type="hidden" th:value="${declarationDetails1.forcePersonalId}" name="forcepersonalId">
																					
																					
												 <button  type="submit" 	class="btn btn-info btn-sm">Status Remark</button>
												
											</form>
										
										
									</td>
								</tr>

							</table>

						</div>

						<br>
						<hr>
						<div class="table-responsive ui-sortable-handle">
							<table class="table table-striped table-bordered table-hover"
								id="example1">

								<thead class="table-light">
									<tr>
										<td colspan="7"><span
											style="font-size: 16px; font-weight: 600;"> AME
												COMPLETED </span></td>
										<td colspan="4"
											style="font-size: 16px; font-weight: 600; text-align: center;">Action</td>
									</tr>
									<tr>
										<th>S No</th>
										<th>Year</th>
										<th>IRLA/REGT No</th>
										<th>Name</th>
										<th>Rank/Designation</th>
										<th>Date Of Declaration</th>
										<th>AME Status</th>
										<th>Investigation</th>
										<th>Declaration</th>
										<th>AME Report</th>
										<th>Result</th>
									</tr>
								</thead>
								<tr
									th:each="declarationDetails1,statcount :${listOfAmeCompletedOrUnderReviewDataList}">
									<td th:text="${statcount.count}"></td>
									<td th:text="${declarationDetails1.AmeYear}"></td>
									<td th:text="${declarationDetails1.candidateIrlaNo}"></td>

									<td th:text="${declarationDetails1.name}"></td>

									<td th:text="${declarationDetails1.candidateRank}"></td>
									<td
										th:text="${#dates.format(declarationDetails1.declarationDate, 'dd/MM/yyyy')}"></td>
									<td><b><span
											th:text="${declarationDetails1.statusValue}"></span></b></td>
									<td>
										<form th:action="@{view-investigation-reports-pdf}"
											method="post" target=”_blank” rel="noopener noreferrer">
											<input type="hidden"
												th:value="${declarationDetails1.candidateForcePersonalId}"
												name="candidateForcePersonnelId"> <input
												type="hidden" th:value="${declarationDetails1.ameId}"
												name="ameId"> <input type="submit"
												value="View Report" class="btn btn-info btn-sm">
										</form>

									</td>
									<td>
										<div class="row">
											<div class="col-md-6">
												<form th:action="@{download-declaration-file-uploaded}"
													method="get" target=”_blank” rel="noopener noreferrer">
													<input type="hidden"
														th:value="${declarationDetails1.candidateForcePersonalId}"
														name="forcepersonalId"> <input type="hidden"
														th:value="${declarationDetails1.ameId}" name="ameId">
													<input type="hidden" th:value="${_csrf.token}" name="_csrf">
													<input type="submit" value="Download"
														class="btn btn-info btn-sm">

												</form>
											</div>
											<div class="col-md-6">
												<form th:action="@{view-declaration-pdf-ame}" method="get">
													<input type="hidden"
														th:value="${declarationDetails1.candidateForcePersonalId}"
														name="forcepersonalId"> <input type="hidden"
														th:value="${declarationDetails1.ameId}" name="ameId">
													<input type="hidden" th:value="${_csrf.token}" name="_csrf">
													<!--   <button class="btn btn-link" onclick="openPdfModal(this)" th:id="${declarationDetails1.ameId}">View File</button> -->
													<input type="submit" value="View Pdf"
														class="btn btn-info btn-sm" style="">
												</form>
											</div>
										</div>





									</td>
									<td>
										<div class="row">
											<div class="col-md-6">
												<form th:action="@{download-ame-final-report-uploaded}"
													method="get" target=”_blank” rel="noopener noreferrer">
													<input type="hidden"
														th:value="${declarationDetails1.candidateForcePersonalId}"
														name="forcepersonalId"> <input type="hidden"
														th:value="${declarationDetails1.ameId}" name="ameId">
													<input type="hidden" th:value="${_csrf.token}" name="_csrf">
													<input type="submit" value="PDF"
														class="btn btn-info btn-sm">

												</form>
											</div>
											<div class="col-md-6">
												<form th:action="@{view-final-report-ame}" method="get">
													<input type="hidden"
														th:value="${declarationDetails1.ameId}" name="ameId">
													<input type="hidden" th:value="${_csrf.token}" name="_csrf">
													<input type="submit" value="View"
														class="btn btn-info btn-sm">

												</form>
											</div>
										</div>


									</td>
									<td>
										<form th:action="@{view-all-ame-result-for-candidate}"
											method="post">
											<input type="hidden"
												th:value="${declarationDetails1.candidateForcePersonalId}"
												name="candidateForcepersonalId"> <input
												type="hidden" th:value="${_csrf.token}" name="_csrf">
											<input type="submit" value="Previous Results"
												class="btn btn-info btn-sm">

										</form>
									</td>

								</tr>

							</table>

						</div>



					</div>
					<form th:action="@{medical-subordinate-dashboard}" method="get">
						<input type="submit" value="Back"
							style="width: 100px; color: rgb(0, 128, 192);">
					</form>
				</div>

			</div>

		</div>
		<div
			th:replace="~{UserMenu/display-declaration-file::sidebar-wrapper-ame-declaration-pdf}"></div>

		<!-- Bootstrap Modal -->

	</div>


	<script>
    function openPdfModal(e) {
    	var ameId=e.id;
        // Set the source of the iframe dynamically
        const pdfViewer = document.getElementById('pdfIframe');
        pdfViewer.src = `/declaration-view?fileName=${ameId}`;

        // Show the modal
        const modal = new bootstrap.Modal(document.getElementById('pdfModal'));
        modal.show();
    }
</script>


	<!-- Menu Toggle Script -->
	<script>
		$("#menu-toggle").click(function(e) {
			e.preventDefault();
			$("#wrapper").toggleClass("toggled");
		});
	</script>


	<script>
		$(document).ready(function() {
			$('#backtotop').click(function() {
				$("html, body").animate({
					scrollTop : 0
				}, 600);
				return false;
			});
		});
	</script>


	<script>
		$('.sub-menu ul').hide();
		$('.sub-sub-menu ul').hide();
		$(".sub-menu a").click(function() {
			$(this).parent(".sub-menu").children("ul").slideToggle("100");
			$(this).find(".right").toggleClass("fa-caret-up fa-caret-down");
		});

		$(".sub-sub-menu a").click(function() {
			$(this).parent(".sub-sub-menu").children("ul").slideToggle("100");
			$(this).find(".right").toggleClass("fa-caret-up fa-caret-down");
		});
	</script>



	<!-- Signup Modal -->
	<div class="modal fade" id="signout-modal">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Sign Out?</h5>

						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<!-- Modal body -->
					<div class="modal-body">
						<p class="text-center">Are you sure you want to Sign Out?</p>
						<form action="sign-out">
							<div class="row">
								<div class="col-md-6">
									<button type="submit" class="btn btn-primary">Sign Out</button>
								</div>
								<div class="col-md-6">
									<button type="button" class="btn btn-secondary"
										data-bs-dismiss="modal">Cancel</button>
								</div>

							</div>

						</form>

					</div>
				</div>
			</div>
		</div>
	</div>



	<script src="vendor/jquery-ui/jquery-ui.js"></script>
	<script>
		$(function() {
			$("#sortable-menu").sortable();
			$("#sortable-menu").disableSelection();

			$("#sortable-cards").sortable();
			$("#sortable-cards").disableSelection();
		});
	</script>


	<script>
		$(function() {
			$("#one-item-row").on("click", function() {
				$(".b-customize").addClass("col-lg-12", 300);
				$(".b-customize").removeClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-6", 300);

			});

			$("#two-item-row").on("click", function() {
				$(".b-customize").addClass("col-lg-6", 300);
				$(".b-customize").removeClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-12", 300);

			});

			$("#three-item-row").on("click", function() {
				$(".b-customize").addClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-6", 300);
				$(".b-customize").removeClass("col-lg-12", 300);

			});

		});
	</script>
	<script>
	     function submitForm() {
            const form = document.getElementById('pdfForm');
            const formData = new FormData(form);
            const params = new URLSearchParams();

            // Build the query string from form data
            for (const pair of formData.entries()) {
                params.append(pair[0], pair[1]);
            }

            // Construct the URL
            const url = `${form.action}?${params.toString()}`;
            console.log("PDF URL:", url);

            // Set the iframe source to the PDF URL
            const iframe = document.getElementById('pdfViewer');
            iframe.src = url;
            iframe.style.display = 'block'; // Show the iframe

            return false; // Prevent the default form submission
        }
    </script>

</body>
</html>