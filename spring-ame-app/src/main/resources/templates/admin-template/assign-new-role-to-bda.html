<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<head>
	<meta charset="ISO-8859-1">


	<title>AME DashBoard User Management</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css" />
	<!-- Custom styles for this template -->
	<link rel="stylesheet" href="/css/local/master1.css"  type="text/css"/>
	<link rel="stylesheet" href="css/base.css" />
	<link rel="stylesheet" href="css/base-responsive.css" />
	<link rel="stylesheet" href="css/animate.min.css" />
	<link rel="stylesheet" href="css/slicknav.min.css" />
	<link rel="stylesheet" href="css/font-awesome.min.css" />
	<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

	<!--Create new Role js file-->
	<script src="js/local/createNewRole.js"></script>

	<!--Create new Role Css File-->
	<link rel="stylesheet" href="css/local/createNewRole.css" />

	<script src="vendor/charts/Chart.js"></script>
	<script src="vendor/charts/moment.min.js"></script>
	<script src="vendor/charts/Chart.min.js"></script>
	<script src="vendor/charts/utils.js"></script>
		<script src="js/local/disable-back-button.js"></script>

	<style>
		#user {
			font-family: 'Courier New', Courier, monospace, 'Times New Roman', Times, serif;
			border-collapse: collapse;
			width: 100%;
		}

		#user td,
		#user th {
			border: 1px solid #ddd;
			padding: 8px;
		}

		#user tr:nth-child(even) {
			background-color: #f2f2f2;
		}

		#user tr:hover {
			background-color: #ddd;
		}

		#user th {
			padding-top: 12px;
			padding-bottom: 12px;
			text-align: left;
			background-color: #0086b3;
			color: white;
		}
	</style>


	<style>
		body {
			background-color: #fff;
		}

		.b-leftmenu ul {
			list-style: none;
			margin: 0;
			padding: 0;
		}

		.b-leftmenu ul li {
			/* Sub Menu */

		}

		.b-leftmenu ul li a {
			display: block;
			background: #ebebeb;
			padding: 10px 15px;
			color: #333;
			text-decoration: none;
			-webkit-transition: 0.2s linear;
			-moz-transition: 0.2s linear;
			-ms-transition: 0.2s linear;
			-o-transition: 0.2s linear;
			transition: 0.2s linear;
		}

		.b-leftmenu ul li a:hover {
			background: #f8f8f8;
			color: #515151;
		}

		.b-leftmenu ul li a .fa {
			width: 16px;
			text-align: center;
			margin-right: 5px;
			float: right;
		}

		.b-leftmenu ul ul {
			background-color: #ebebeb;
		}

		.b-leftmenu .sub-menu ul li a {
			background: #f8f8f8;
			border-left: 4px solid transparent;
			padding: 10px 25px;
		}

		.b-leftmenu .sub-sub-menu ul li a {
			padding: 10px 20px 10px 40px;
		}

		.b-leftmenu a.b-newpage:hover {
			background: #ebebeb;
			border-left: 4px solid #3498db;
		}

		.card {
			box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
			max-width: 300px;
			margin: auto;
			text-align: center;
			font-family: Georgia, 'Times New Roman', Times, serif;
		}

		.title {
			color: grey;
			font-size: 14px;
		}

		button {
			border: none;
			outline: 0;
			display: inline-block;
			padding: 8px;
			color: white;
			background-color: #000;
			text-align: center;
			cursor: pointer;
			width: 100%;
			font-size: 14px;
		}

		a {
			text-decoration: none;
			font-size: 14px;
			color: black;
		}

		button:hover,
		a:hover {
			opacity: 0.7;
		}
	</style>
</head>


<body>



	<div class="d-flex" id="wrapper">
<div th:replace="~{admin-template/admin-left-menu::admin-left-menu}"></div>


		<!-- /#sidebar-wrapper -->

		<!-- Page Content -->
		<div id="page-content-wrapper">

			<div th:replace="~{admin-template/nav-bar-bda::sidebar-wrapper-menu-nav-bda}"></div>
			



			<div class="container-fluid">

				<!-- Content Row -->



				<div class="my-5" id="b-homedb">

					<div class="container">

						<h4 class="text-center mb-3 b-latest-data">Assigned Role</h4>




						<div class="" style="overflow: scroll;">



							<div>
								<span style="color: darkred; font-size: 20px;" th:if="${message!=null}"
									th:text="${message}"></span>

								<table id="user">

									<thead>
										<tr>
											<th>Serial No</th>
											<th>ForceName</th>
											<th>IRLA No</th>
											<th>Name</th>

											<th>Rank/Designation</th>

											<th>Unit Name</th>
											<th>Role Name</th>
											<th colspan="3" align="center">Action</th>
										</tr>
									</thead>
									<tr th:each="userRoleDtosList,statcount :${userRoleDtosList}">
										<td th:text="${statcount.count}"></td>
										<td th:text="${userRoleDtosList.forceName}"></td>
										<td th:text="${userRoleDtosList.irlaNo}"> </td>

										<td th:text="${userRoleDtosList.name}"></td>

										<td th:text="${userRoleDtosList.rank}"></td>

										<td th:text="${userRoleDtosList.unitName}"></td>
										<td th:text="${userRoleDtosList.role}"></td>


										<td>
											<form action="manage-existing-user-role" method="post">
												<input type="hidden" th:value="${userRoleDtosList.forcePersonalId}"
													name="forcepersonalId">

												<input type="hidden" th:value="${_csrf.token}" name="_csrf">
												<input type="submit" value="modified">

											</form>
										</td>
										<!--<td>
											<form action="view-user-role-details" method="post">
												<input type="hidden" th:value="${userRoleDtosList.forcePersonalId}"
													name="forcepersonalId">

												<input type="hidden" th:value="${_csrf.token}" name="_csrf">
												<input type="submit" value="view ">

											</form>
										</td>-->

									</tr>

								</table>

							</div>
							<div>

							</div>


						</div>

					</div>

					<h3 class="text-center mb-3 b-latest-data">Assign Role</h3>
					<hr>
					<div style="width: 80;margin-left:9%;">


						<div class="row">
							<div class="col-md-2" style="background-color:lavender;">Select Force Name</div>
							<div class="col-md-3" style="background-color:lavenderblush;">
								<select id="forceName_id" style="width:200px">
									<option value="0">Select
									</option>
									<option th:each="forceList: ${forceList}" th:value="${forceList.forceId}"
										th:text="${forceList.forceName}">
									</option>
								</select>
							</div>
							<div class="col-md-3" style="background-color:lavender;">Select Unit Name</div>
							<div class="col-md-3" style="background-color:lavender;">

								<label>

									<select id="unit_Id" style="width:200px">
									</select>

								</label>

							</div>
						</div>
					</div>

					<table class="table table-bordered table-sm mt-2" id="example">
						<thead>
							<tr>

								<th>S.No</th>
								<th>Force Name</th>
								<th>IRLA No</th>
								<th>Name</th>
								<th>Force Unit</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody id="myTable">

						</tbody>
					</table>

					<hr>

					<!--  hidden section-->


				</div>

				
</div>
			

		




	</div>
	<!-- /#page-content-wrapper -->

	</div>
	<!-- /#wrapper -->



	<!-- Bootstrap core JavaScript -->
	<script src="vendor/jquery/jquery.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="js/jquery.slicknav.min.js"></script>
	<script src="js/dashboard.js"></script>

	<!-- Menu Toggle Script -->
	<script>
		$("#menu-toggle").click(function (e) {
			e.preventDefault();
			$("#wrapper").toggleClass("toggled");
		});
	</script>


	<script>
		$(document).ready(function () {
			$('#backtotop').click(function () {
				$("html, body").animate({
					scrollTop: 0
				}, 600);
				return false;
			});
		});
	</script>


	<script>
		$('.sub-menu ul').hide();
		$('.sub-sub-menu ul').hide();
		$(".sub-menu a").click(function () {
			$(this).parent(".sub-menu").children("ul").slideToggle("100");
			$(this).find(".right").toggleClass("fa-caret-up fa-caret-down");
		});

		$(".sub-sub-menu a").click(function () {
			$(this).parent(".sub-sub-menu").children("ul").slideToggle("100");
			$(this).find(".right").toggleClass("fa-caret-up fa-caret-down");
		});
	</script>



	<!-- Signup Modal -->
	<div class="modal fade" id="signout-modal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header text-center d-block p-5 border-bottom-0">
					<h3 class="modal-title">Sign Out?</h3>
					<button type="button" class="close position-absolute" style="right: 15px; top: 8px;"
						data-dismiss="modal">&times;</button>
				</div>

				<!-- Modal body -->
				<div class="modal-body">
					<p class="text-center">Are you sure you want to Sign Out?</p>
					<div class="text-center py-4">
						<form action="sign-out">
							<button type="submit" class="btn btn-primary b-btn mx-3">Sign
								Out</button>
							<button class="btn btn-secondary mx-3" data-dismiss="modal">Cancel</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>




	<!--Model-2 for role Assign-->
	<!-- The Modal -->
	<div id="createRoleModeId" class="modal2">

		<!-- Modal content -->
		<div class="modal-content2">
			<span class="close2" onclick="closeModel()">&times;</span>
			<form th:action="@{assign-new-role-super-user}" method="post" id="form_id" enctype="multipart/form-data">


				<div class="container-2">
					<div class="row">
						<div class="col-md-12">
							<h5>Create New Role</h5>
						</div>
					</div>

					<hr>

					<div class="row">
						<div class="col-md-4">
							<label>IRLA No :-</label>
						</div>
						<div class="col-md-6">
							<span class="s1" id="irlaNo"></span>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<label>
								Name :-
							</label>
						</div>
						<div class="col-md-6">
							<span class="s1" id="name">

							</span>
						</div>
					</div>

					<div class="row">
						<div class="col-md-4">
							<label>
								Designation :-
							</label>

						</div>
						<div class="col-md-6">
							<span class="s1" id="rank">

							</span>
						</div>
					</div>


					<div class="row">
						<div class="col-md-4">
							<label>
								Force Name :-
							</label>

						</div>
						<div class="col-md-6">
							<span class="s1" id="forceName"></span>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<label>
								Unit :-
							</label>
						</div>
						<div class="col-md-6">
							<span class="s1" id="unit">

							</span>
						</div>

					</div>
					<br>

				</div>

				<div class="container-3">
					<div class="row">
						<div class="col-md-4">
							<label> Order Number *</label>
						</div>
						<div class="col-md-6">
							<input type="text" name="orderNumbar" required>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<label> Order Date *</label>
						</div>
						<div class="col-md-6">
							
							<input type="date"  name="orderDate"  max="" id="date-input"  required>
						</div>
					</div>
						<div class="row">
						<div class="col-md-4">
							<label> Order By (Name/Irla No) *</label>
						</div>
						<div class="col-md-6">
							
							<input type="text"  name="name_irlaNo"  required>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<label> Designation *</label>
						</div>
						<div class="col-md-6">
							<input type="text" name="designation" required>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<label> Department * </label>
						</div>
						<div class="col-md-6">
							<select name="department" id="departmentId">
								<option value="0">MHA</option>
								<option value="1">Assam Rifle</option>
								<option value="2">BSF</option>
								<option value="3">CISF</option>
							</select>
						</div>
					</div>

					<div class="row">
						<div class="col-md-4">
							<label> Role Type *</label>
						</div>
						<div class="col-md-6">

							<div class="roleList" id="roleList">

								<select class="roleTypeSelect" id="roleTypeSelect">

								</select>


							</div>
						</div>
					</div>
						<div class="row">
						<div class="col-md-4">
							<label>Permission To Assign Role*</label>
						</div>
						<div class="col-md-6">

							<div>

								<select  id="permissionList">

								</select>


							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<label>Attach File *</label>
						</div>
						<div class="col-md-6">
							<input type="file" name="file" required id="file">
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<label>Remark *</label>
						</div>
						<div class="col-md-6">
							<input type="text" name="remark" required>
						</div>
					</div>

					<br>
					<div class="row">
						<div class="col-md-6">

						</div>

						<div class="col-md-3">
							<input type="hidden" name="forcePersonalIdAssignRole" id="forcePersonalIdAssignRole">
							<input type="hidden" name="roleId" id="roleIdId">
							<input type="hidden" name="permissionRoleId" id="permissionRoleId">
							<button
								style="width:20%;background-color: rgb(0, 87, 130);font-weight: bold; font-size: 14px;width: 65%;"
								onclick="assign_newRole()">
								Assign
							</button>
						</div>
						<div class="col-md-3">
							<button
								style="width:20%;background-color: rgb(0, 87, 130);font-weight: bold; font-size: 14px;width:65%;"
								onclick="closeModel()">
								Cancel
							</button>
						</div>
					</div>


				</div>
			</form>
		</div>
	</div>

	<script src="vendor/jquery-ui/jquery-ui.js"></script>
	<script>
		$(function () {
			$("#sortable-menu").sortable();
			$("#sortable-menu").disableSelection();

			$("#sortable-cards").sortable();
			$("#sortable-cards").disableSelection();
		});
	</script>


	<script>
		$(function () {
			$("#one-item-row").on("click", function () {
				$(".b-customize").addClass("col-lg-12", 300);
				$(".b-customize").removeClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-6", 300);

			});

			$("#two-item-row").on("click", function () {
				$(".b-customize").addClass("col-lg-6", 300);
				$(".b-customize").removeClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-12", 300);

			});

			$("#three-item-row").on("click", function () {
				$(".b-customize").addClass("col-lg-4", 300);
				$(".b-customize").removeClass("col-lg-6", 300);
				$(".b-customize").removeClass("col-lg-12", 300);

			});

		});




		$(document).ready(function () {


			$('#forceName_id').on('change', function () {

				var forceId = $(this).val();


				var token = $("meta[name='_csrf']").attr("content");
				var header = $("meta[name='_csrf_header']").attr("content");
				$.ajax({
					type: 'Post',
					url: 'get-unit-by-forceNo-board',

					data: {forceId: forceId}, beforeSend: function (xhr) {

						xhr.setRequestHeader(header, token);
					},

					success: function (data) {

						console.log(data);
						const dropdown = document.getElementById("unit_Id");
						dropdown.innerHTML = "";
						const option = document.createElement("option");
						option.text = 'Select';
						option.value = 0;
						// !-- option.setAttribute("data", data[i].forceId)-->
						dropdown.appendChild(option);
						for (let i = 0; i < data.length; i++) {
							const option = document.createElement("option");
							option.text = data[i].unitName;
							option.value = data[i].unitId;
							// !-- option.setAttribute("data", data[i].forceId)-->
							dropdown.appendChild(option);
						}

					},
					error: function (e) {



						console.log("ERROR : ", e);

					}
				});
			});
		});


		//=========//


		//=======get forcePersonal details by unit==================//

		$('#unit_Id').on('change', function () {
			var unitId = $(this).val();
			var forceName_id = $("#forceName_id").val();
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");

			let text = "Press a button!\nEither OK or Cancel.";
			if (confirm(text) == true) {
				text = "CONFIRM TO SEARCH DATA PRESS OK ";


				$.ajax({

					type: "post",
					url: "get-force-personal-by-unit-force-id",
					cache: false,
					dataType: 'json',

					data: ({queryData: JSON.stringify({unitNo: unitId, forceNo: forceName_id})}),


					beforeSend: function (xhr) {

						xhr.setRequestHeader(header, token);
					},
					success: function (response) {
						console.log(response);
						var table = document.getElementById("myTable");
						while (table.rows.length > 0) {
							table.deleteRow(0);
						}
						createTable(response.personalResponeseAjax);
						crateDropDownRoleList(response.masterRoleList);
						crateDropDownPermissionList(response.masterRoleList);
					},
					error: function () {
						alert('Error while request..');
					}
				});
			}
		});




		//===================create table dynamically to fetch data==================//
		function createTable(response) {
			var trHTML = '';

			$.each(response, function (i, o) {
				trHTML += '<tr  class="memberData" ><td>' + i + '<input type="hidden" id="forcePersonalId" value="' + o.forcePersonalId + '"' +
					'</td><td><input type="hidden" id="forceNameId" value="' + o.forceName + '">' + o.forceName +
					'</td><td><input type="hidden"  id="irlaNoId" value="' + o.irlaNumber + '">' + o.irlaNumber +
					'</td><td><input type="hidden" id="nameId" value="' + o.name + '">' + o.name +

					'</td><td><input type="hidden" id="unitNameId" value="' + o.unitName + '" >' + o.unitName +
					'</td><td>' + ' <button class="btnAddToList" name="btnAddToList" onclick="createNewRoleModelBybda(this)">Assign Role</button>' +
					'</td></tr>';
			});

			$('#myTable').append(trHTML);

		}



	



		//========sending data to save =======//

		$('#membersubmit').click(function () {
			var formData = [];

			var table = $(tbodyfinal);
			console.log(table.children.length);
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			var rows = table.find('.memberData');
			if (rows.length != 0) {
				for (var i = 0; i < rows.length; i++) {
					var rowData = {};
					rowData['irlaNo'] = $(rows[i]).find('#irlaNoId').val();
					rowData['name'] = $(rows[i]).find('#nameId').val();
					rowData['forceName'] = $(rows[i]).find('#forceNameId').val();
					rowData['unitName'] = $(rows[i]).find('#unitNameId').val();
					rowData['roleName'] = $(rows[i]).find('#roleTypeSelect :selected').val();
					rowData['forcePersonalId'] = $(rows[i]).find("#forcePersonalId").val();





					// set all data

					formData.push(rowData);
				}


				console.log(formData);
				var datan = "hello";
				var data1 = JSON.stringify(formData);
				//set value of committeeMemberData 
				//$('committeeMemberData').val(JSON.stringify(formData));

				//$('membersubmit').submit(

				$.ajax({
					type: "POST",
					contentType: "application/json",
					url: "get-new-role-to-user",
					data: data1,
					dataType: 'json',
					/* cache: false,
					timeout: 600000, */
					beforeSend: function (xhr) {

						xhr.setRequestHeader(header, token);
					},
					success: function (data) {
						alert(data.message);
						rows.remove();
						window.location.href = "assign-new-role-to-user";
					},
					error: function (e) {



						console.log("ERROR : ", e);

					}
				});
			}
			else {
				alert("Please chose atleast one member in Board");
			}

			// JSON.stringify(formData)
			// form submit
			//$('membersubmitt').submit();
			//form.submit();
			//e.submit();
			//document.membersubmitt.submit();

		}
		);

		function deleteFromList(e) {
			var row = $(e).closest('.memberData').remove();

		}


	</script>
<script>
	  /*date disable future date picking*/
   var today=new Date().toISOString().split('T')[0];
    document.getElementById("date-input").setAttribute("max",today);
  
</script>

</body>

</html>